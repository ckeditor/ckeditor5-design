<!DOCTYPE html>
<html>
<head>
	<title>PoC</title>
	<script src="node_modules/systemjs/dist/system.js"></script>
	<script>

'use strict';

System.transpiler = 'babel';

System.config( {
	map: {
		babel: 'node_modules/systemjs/node_modules/babel-core/browser.js'
	}
} );

( () => {
	// Store the old normalization function.
	const systemNormalize = System.normalize;

	// Override the normalization function.
	System.normalize = function( name, parentName, parentAddress ) {
		let normalizedName = name;

		// Inject superbutton instead of a button unless asking from inside of superbutton.
		if ( normalizedName.startsWith( 'ckeditor5-button/' ) && ( !parentName || parentName.indexOf( 'ckeditor5-superbutton/' ) == -1 ) ) {
			normalizedName = normalizedName.replace( /^ckeditor5-button\//, 'ckeditor5-superbutton/' );
			console.log( `Injected ckeditor5-superbutton in place of ckeditor-button. Parent name: ${ parentName }` );
		}

		normalizedName = normalizedName.replace( /ckeditor5-([^\/]+)\//, 'node_modules/ckeditor5-$1/src/' );

		console.log( `\t\tname: ${ name }, normalized name: ${ normalizedName }` );

		let ret = systemNormalize.call( this, normalizedName, parentName, parentAddress );

		ret = ret.then( ( url ) => {
			console.log( `\t\tnormalized name: ${ normalizedName }, resolved name: ${ url }` );

			return url;
		} );

		return ret;
	};
} )();

System.import( 'ckeditor.js' ).then( ( CKEDITORModule ) => {
	const CKEDITOR = CKEDITORModule.default;

	CKEDITOR.create( {
		features: [
			'basicstyles/bold',
			'basicstyles/italic',
			'classiccreator',
			'image/imagecaption',
			'button'
		]
	} ).then( ( editor ) => {
		// debugger;
	} );
} );

	</script>
</head>
<body>
</body>
</html>