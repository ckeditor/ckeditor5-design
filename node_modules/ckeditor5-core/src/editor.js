'use strict';

import Model from './model.js';
import CKEDITOR from 'ckeditor.js';

export default class Editor extends Model {
	constructor( features ) {
		super();

		console.log( 'Editor.constructor()' );

		this._features = features;
	}

	init() {
		this.features = new Map();

		const promises = [];

		this._features.forEach( ( featureName ) => {
			if ( featureName.indexOf( '/' ) == -1 ) {
				featureName = `ckeditor5-${ featureName }/src/${ featureName }`;
			} else {
				featureName = `ckeditor5-${ featureName.replace( /\//, '/src/' ) }`;
			}

			const promise = System
				.import( featureName + '.js' )
				.then( ( FeatureModule ) => {
					const Feature = FeatureModule.default;

					this.features.set( featureName, new Feature( this ) );
				} );

			promises.push( promise );
		} );

		return Promise.all( promises ).then( () => this );
	}

	static circularCKEDITORRef() {
		return JSON.stringify( CKEDITOR );
	}
}